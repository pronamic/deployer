#!/bin/bash

# Pronamic Deployer
# https://github.com/pronamic/deployer

while [ $# -gt 0 ]
do
    case "$1" in
        -s)  SLUG="$2"; MAIN_FILE="$SLUG.php"; shift;;
        -g)  GIT_URL="$2"; shift;;
        -m)  MAIN_FILE="$2"; shift;;
        -*)
            echo >&2 \
            "usage: $0 [-p plugin-name] [-u svn-username] [-m main-plugin-file] [-a assets-dir-name] [-t tmp directory] [-i path/to/i18n] [-h history/changelog file]"
            exit 1;;
        *)  break;; # terminate while loop
    esac
    shift
done

# General
DEPLOYER_DIR=$(pwd)

$DEPLOYER_DIR/bin/wp-build -s $SLUG -g $GIT_URL

# AWS S3

echo
echo "☁️  AWS S3"
echo

aws s3 cp ./$ZIP_PATH/$SLUG.$VERSION.zip s3://downloads.pronamic.eu/plugins/$SLUG/$SLUG.$VERSION.zip --acl public-read
